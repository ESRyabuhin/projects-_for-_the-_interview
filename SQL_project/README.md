# Описание проекта
## Таблицы
     
* user_actions — действия пользователей с заказами
* courier_actions — действия курьеров с заказами
* orders — информация о заказах
* users — информация о пользователях
* couriers — информация о курьерах
* products — информация о товарах, которые доставляет сервис
## Задания
### Задача 1.

Начнём с выручки — наиболее общего показателя, который покажет, какой доход приносит наш сервис.
Для каждого дня в таблице `orders` рассчитайте следующие показатели:,  
> 1. Выручку, полученную в этот день,  
> 2. Суммарную выручку на текущий день,  
> 3. Прирост выручки, полученной в этот день, относительно значения выручки за предыдущий день.

### Задача 2.

Для каждого дня в таблицах `orders` и `user_actions` рассчитайте следующие показатели:
> 1. Выручку на пользователя `(ARPU)` за текущий день,
> 2. Выручку на платящего пользователя `(ARPPU)` за текущий день,
> 3. Выручку с заказа, или средний чек `(AOV)` за текущий день.

### Задача 3.

По таблицам `orders` и `user_actions` для каждого дня рассчитайте следующие показатели:
> 1. Накопленную выручку на пользователя `(Running ARPU)`,
> 2. Накопленную выручку на платящего пользователя `(Running ARPPU)`,
> 3. Накопленную выручку с заказа, или средний чек `(Running AOV)`.

### Задача 4.

Посчитайте те же показатели, но в другом разрезе — не просто по дням, а по дням недели.  
Для каждого дня недели в таблицах `orders` и `user_actions` рассчитайте следующие показатели:  
> 1. Выручку на пользователя `(ARPU)`.
> 2. Выручку на платящего пользователя `(ARPPU)`.
> 3. Выручку на заказ `(AOV)`.
   
При расчётах учитывайте данные только за период с 26 августа 2022 года по 8 сентября 2022 года включительно — так, чтобы в анализ попало одинаковое количество всех дней недели (ровно по два дня).  
В результирующую таблицу включите как наименования дней недели (например, Monday), так и порядковый номер дня недели (от 1 до 7, где 1 — это Monday, 7 — это Sunday).

### Задача 5.

Немного усложним наш первоначальный запрос и отдельно посчитаем ежедневную выручку с заказов новых пользователей нашего сервиса. Посмотрим, какую долю она составляет в общей выручке с заказов всех пользователей — и новых, и старых.  
Для каждого дня в таблицах `orders` и `user_actions` рассчитайте следующие показатели:
> 1. Выручку, полученную в этот день.
> 2. Выручку с заказов новых пользователей, полученную в этот день.
> 3. Долю выручки с заказов новых пользователей в общей выручке, полученной за этот день.
> 4. Долю выручки с заказов остальных пользователей в общей выручке, полученной за этот день.

### Задача 6.

Также было бы интересно посмотреть, какие товары пользуются наибольшим спросом и приносят нам основной доход.  
Для каждого товара, представленного в таблице `products`, за весь период времени в таблице `orders` рассчитайте следующие показатели:  
> 1. Суммарную выручку, полученную от продажи этого товара за весь период.
> 2. Долю выручки от продажи этого товара в общей выручке, полученной за весь период.  

Товары, округлённая доля которых в выручке составляет менее 0.5%, объедините в общую группу с названием «ДРУГОЕ» (без кавычек), просуммировав округлённые доли этих товаров.

### Задача 7.

Теперь попробуем учесть в наших расчётах затраты с налогами и посчитаем валовую прибыль, то есть ту сумму, которую мы фактически получили в результате реализации товаров за рассматриваемый период.  
Для каждого дня в таблицах `orders` и `courier_actions` рассчитайте следующие показатели:  
1. Выручку, полученную в этот день.
2. Затраты, образовавшиеся в этот день.
3. Сумму НДС с продажи товаров в этот день.
4. Валовую прибыль в этот день (выручка за вычетом затрат и НДС).
5. Суммарную выручку на текущий день.
6. Суммарные затраты на текущий день.
7. Суммарный НДС на текущий день.
8. Суммарную валовую прибыль на текущий день.
9. Долю валовой прибыли в выручке за этот день (долю п.4 в п.1).
10. Долю суммарной валовой прибыли в суммарной выручке на текущий день (долю п.8 в п.5).

Чтобы посчитать затраты, в этой задаче введём дополнительные условия. В упрощённом виде затраты нашего сервиса будем считать как сумму постоянных и переменных издержек. К постоянным издержкам отнесём аренду складских помещений, а к переменным — стоимость сборки и доставки заказа. Таким образом, переменные затраты будут напрямую зависеть от числа заказов. Из данных, которые нам предоставил финансовый отдел, известно, что в августе 2022 года постоянные затраты составляли 120 000 рублей в день. Однако уже в сентябре нашему сервису потребовались дополнительные помещения, и поэтому постоянные затраты возросли до 150 000 рублей в день. Также известно, что в августе 2022 года сборка одного заказа обходилась нам в 140 рублей, при этом курьерам мы платили по 150 рублей за один доставленный заказ и ещё 400 рублей ежедневно в качестве бонуса, если курьер доставлял не менее 5 заказов в день. В сентябре продакт-менеджерам удалось снизить затраты на сборку заказа до 115 рублей, но при этом пришлось повысить бонусную выплату за доставку 5 и более заказов до 500 рублей, чтобы обеспечить более конкурентоспособные условия труда. При этом в сентябре выплата курьерам за один доставленный заказ осталась неизменной. При расчёте переменных затрат учитывайте следующие условия:  
1. Затраты на сборку учитываются в том же дне, когда был оформлен заказ. Сборка отменённых заказов не производится.  
2. Выплата курьерам за доставленный заказ начисляется сразу же после его доставки, поэтому если курьер доставит заказ на следующий день, то и выплата будет учтена в следующем дне.  
3. Для получения бонусной выплаты курьерам необходимо доставить не менее 5 заказов в течение одного дня, поэтому если курьер примет 5 заказов в течение дня, но последний из них доставит после полуночи, бонусную выплату он не получит.  

При расчёте НДС учитывайте, что для некоторых товаров налог составляет 10%, а не 20%.
